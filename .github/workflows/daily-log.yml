name: Setup Daily Log Entry

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  add-daily-line:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Insert Decorated Daily Date
        run: |
          # 1. í•œêµ­ ì‹œê°„ ê¸°ì¤€ ë‚ ì§œ ë° ìš”ì¼ êµ¬í•˜ê¸°
          TODAY=$(date -u -d "+9 hours" "+%Y-%m-%d (%a)")
          
          # 2. íŒŒì¼ì´ ì—†ìœ¼ë©´ ì´ˆê¸° ì œëª© ìƒì„±
          if [ ! -f daily-log.md ]; then
            echo "# ðŸŒ³ My Daily Learning Log" > daily-log.md
            echo -e "í•˜ë£¨ì˜ ì„±ìž¥ì„ ê¸°ë¡í•©ë‹ˆë‹¤.\n" >> daily-log.md
          fi

          # 3. ìƒˆë¡œìš´ ë‚ ì§œ ì„¹ì…˜ ìƒì„± (ì¸ìš©êµ¬ + ì´ëª¨ì§€ + ë³¼ë“œì²´)
          echo "> ### ðŸŒ± **$TODAY**" > temp_entry.md
          echo "- " >> temp_entry.md
          echo -e "\n---" >> temp_entry.md
          echo -e "\n" >> temp_entry.md
          
          # 4. ê¸°ì¡´ ë‚´ìš©ì„ ìƒˆ ì„¹ì…˜ ë’¤ì— ë¶™ì´ê¸°
          cat daily-log.md >> temp_entry.md
          mv temp_entry.md daily-log.md

      - name: Commit and Push
        run: |
          git config --global user.name "kangsangmoon"
          git config --global user.email "sangmoonkang@naver.com"
          git add daily-log.md
          TODAY=$(date -u -d "+9 hours" "+%Y-%m-%d (%a)")
          git commit -m "chore: add daily log entry for $TODAY" || echo "No changes to commit"
          git push
